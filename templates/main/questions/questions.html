{% extends 'base.html' %}

{% block content %}

  <div class="container">

    {% comment %}Фильтр по заголовку{% endcomment %}

    <div class="search-container">
      <label for="filter-input">Filter by title:</label>
      <input type="text" id="filter-input">
      <button onclick="handleSearch()">Search</button>
    </div>
    
    <script>
      // Функция для обработки нажатия клавиши Enter
      function handleKeyPress(event) {
        if (event.keyCode === 13) { // Код клавиши Enter
          handleSearch();
        }
      }
    
      // Функция для выполнения поиска
      function handleSearch() {
        const inputElement = document.getElementById('filter-input');
        handleFilterChange(inputElement);
      }
    
      // Функция для обработки изменений в фильтре
      function handleFilterChange(inputElement) {
        const filterValue = inputElement.value.trim().toLowerCase();
        const questionTitles = document.querySelectorAll('.question-title');
        questionTitles.forEach(function(title) {
          const questionTitleText = title.textContent.toLowerCase();
          if (questionTitleText.includes(filterValue)) {
            title.parentNode.style.display = 'block';
          } else {
            title.parentNode.style.display = 'none';
          }
        });
      }
    
      // Назначение обработчика события для поля ввода
      const inputElement = document.getElementById('filter-input');
      inputElement.addEventListener('keypress', handleKeyPress);
    </script>

    <style>
      body {
        background-color: #1a1a1a;
        color: #ffffff;
        padding-top: 100px; /* Добавляем отступ сверху, чтобы не перекрывать содержимое */
      }
    
      .search-container {
        position: fixed;
        top: -80px;
        left: 20px;
        width: 920px; /* Изменили ширину на 150px */
        background-color: #2b2b2b;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      }  
      label {
        font-size: 18px;
        margin-right: 10px;
      }
    
      input[type="text"] {
        width: 600px;
        padding: 10px;
        font-size: 16px;
        border-radius: 4px;
        border: none;
      }
      button {
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 4px;
        border: none;
        background-color: #4c4c4c;
        color: #ffffff;
        cursor: pointer;
      }
      /* Добавляем отступ сверху для контента, чтобы не перекрывать его элементом search bar */
      .content {
        margin-top: 120px;
      }
    </style>

    {% comment %}Заголовок{% endcomment %}

    <h1>All questions</h1>
    <p>Total number of questions: {{ questions.count }}</p>

    {% comment %}Сортировка{% endcomment %}

    <div class="sort-options">
      <label>Sort by:</label>
      <select id="sort-by-select" onchange="handleSortByChange(this)">
        <option value="-created_at" {% if sort_by == '-created_at' %}selected{% endif %}>Newest</option>
        <option value="created_at" {% if sort_by == 'created_at' %}selected{% endif %}>Oldest</option>
      </select>
    </div>

    <script>
      function handleSortByChange(selectElement) {
        const selectedValue = selectElement.value;
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('sort_by', selectedValue);
        window.location.search = urlParams.toString();
      }
    </script>

    <style>
      .sort-options {
        margin-bottom: 10px;
        text-align: right;
      }
    </style>

    {% comment %}Вывод вопросов{% endcomment %}

    <div id="question-list">
      {% for question in page %}
        <div class="question">
          <h2 class="question-title"><a href="{% url 'question_detail' question.id %}">{{ question.title }}</a></h2>
          <p class="question-details">{{ question.content }}</p>
          <p class="timestamp">Asked at: {{ question.created_at }}</p>
        </div>
      {% endfor %}
    </div>

    <style>
      .question {
        background-color: #ffffff;
        border: 1px solid #d6d9dc;
        border-radius: 4px;
        padding: 20px;
      }
      
      .question-title {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 10px;
      }
      
      .question-details {
        color: #666666;
        margin-bottom: 20px;
      }
      
      .timestamp {
        font-size: 14px;
        color: #999999;
        position: relative;
        top: 10px;
        right: -700px;
      }
    </style>

    {% comment %}Переключение страниц{% endcomment %}

    <div class="pagination">
      {% if page.has_previous %}
        <a href="?page={{ page.previous_page_number }}">Previous</a>
      {% endif %}
      
      <span class="current-page">{{ page.number }}</span>

      {% if page.has_next %}
        <a href="?page={{ page.next_page_number }}">Next</a>
      {% endif %}
    </div>

    <style>
      .pagination {
        position: absolute;
        bottom: 0;
        right: 0;
        margin-bottom: -30px;
        margin-right: 20px;
      }
      .pagination a {
        display: inline-block;
        padding: 5px 10px;
        background-color: #f1f1f1;
        color: #333333;
        text-decoration: none;
        border: 1px solid #cccccc;
        border-radius: 3px;
        margin-left: 5px;
      }
      .pagination .current-page {
        display: inline-block;
        padding: 5px 10px;
        background-color: #333333;
        color: #ffffff;
        border: 1px solid #333333;
        border-radius: 3px;
        margin-left: 5px;
      }
    </style>
  
  </div>

  <style>

    body {
      font-family: Arial, sans-serif;
      font-size: 14px;
      line-height: 1.5;
      color: #333333;
      background-color: #f6f6f6;
    }
    
    .container {
      left:10px;
      transform: scale(0.7);
      max-width: 960px;
      padding: 20px;
      margin: -120px auto 0;
      margin-left: auto;
      margin-right: auto;
    }
  </style>

{% endblock %}